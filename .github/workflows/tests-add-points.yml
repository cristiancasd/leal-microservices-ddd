name: tests-add-points

on: 
  pull_request:
    paths:
      - 'add-points/**'  


jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    services:
      kafka:
        image: "confluentinc/cp-kafka:latest"
        ports:
          - 29092:29092
        options: >-
          -e KAFKA_ZOOKEEPER_CONNECT=localhost:2181
          -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://localhost:29092
          -e KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
        env:
          KAFKA_BROKERS: localhost:29092
          KAFKA_TOPIC: algo-prueba

    steps:
      - uses: actions/checkout@v2
      - run: cd add-points && npm install && npm run test:ci
        env:
          AWS_DEFAULT_REGION: us-east-1   
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          KAFKA_BROKERS: localhost:29092
          KAFKA_TOPIC: algo-prueba
